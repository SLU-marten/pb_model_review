<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Species Model Reports</title>
    <style>
        /* Befintlig CSS, med ett nytt tillägg längst ner */
        body, html {
            margin: 0; padding: 0; height: 100%;
            font-family: sans-serif; overflow: hidden;
        }
        .container { display: flex; height: 100vh; }
        .sidebar {
            width: 250px; background-color: #f4f4f4;
            border-right: 1px solid #ddd; padding: 15px;
            overflow-y: auto; display: flex; flex-direction: column;
        }
        .sidebar h2 { margin-top: 0; font-size: 1.2em; }
        .selector-group {
            margin-bottom: 20px; padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .sidebar .selector-group div { margin-bottom: 5px; }
        .sidebar .selector-group label { margin-left: 5px; }
        .sidebar ul {
            list-style-type: none; padding: 0; margin: 0;
            flex-grow: 1;
        }
        .sidebar li a {
            display: block; padding: 8px 12px;
            text-decoration: none; color: #333;
            border-radius: 4px; cursor: pointer;
        }
        .sidebar li a:hover { background-color: #e2e2e2; }
        .sidebar li a.active {
            background-color: #007bff; color: white;
            font-weight: bold;
        }
        .content { flex-grow: 1; }
        iframe { width: 100%; height: 100%; border: none; }

        /* NY CSS FÖR SPRÅK-RADIOKNAPPARNA */
        .language-radios {
            margin-bottom: 15px;
            padding-bottom: 10px;
        }
        .language-radios label {
            margin-right: 15px;
            font-size: 0.9em;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container">
        <nav class="sidebar">
            <div id="run-selector-container" class="selector-group">
                <h2>Select a Run</h2>
            </div>

            <h2>Select a Species</h2>
            
            <div id="language-selector-container" class="language-radios">
                <label>
                    <input type="radio" name="language" value="sv" checked> Swe
                </label>
                <label>
                    <input type="radio" name="language" value="en"> Eng
                </label>
                <label>
                    <input type="radio" name="language" value="la"> Sci
                </label>
            </div>
            
            <ul id="species-list">
            </ul>
        </nav>

        <main class="content">
            <iframe id="report-viewer" name="report-viewer" title="Species Report Content">
                <p>Your browser does not support iframes.</p>
            </iframe>
        </main>
    </div>

    <script src="reports_data.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Hämta referenser till elementen
        const runSelectorContainer = document.getElementById('run-selector-container');
        const speciesListElement = document.getElementById('species-list');
        const reportViewerElement = document.getElementById('report-viewer');
        // NYTT: Hämta referens till alla radioknappar för språk
        const languageRadios = document.querySelectorAll('input[name="language"]');

        let currentActiveLink = null;
        let currentSpeciesKey = null;

        function populateRunSelector() {
            const runs = Object.keys(reportsData);
            runs.forEach((runId, index) => {
                const div = document.createElement('div');
                const input = document.createElement('input');
                input.type = 'radio';
                input.id = runId;
                input.name = 'run-version';
                input.value = runId;
                const label = document.createElement('label');
                label.htmlFor = runId;
                label.textContent = runId;
                div.appendChild(input);
                div.appendChild(label);
                runSelectorContainer.appendChild(div);
                input.addEventListener('change', onRunChange);
                if (index === 0) {
                    input.checked = true;
                }
            });
        }
        
        // ÄNDRAD: Använder nu radioknappar för att hämta språk
        function populateSpeciesList(runId) {
            speciesListElement.innerHTML = '';
            currentActiveLink = null;
            currentSpeciesKey = null;

            // ÄNDRAD: Sättet att hämta det valda språkvärdet
            const selectedLang = document.querySelector('input[name="language"]:checked').value;
            const speciesInRun = reportsData[runId];

            if (!speciesInRun || speciesInRun.length === 0) {
                const listItem = document.createElement('li');
                listItem.textContent = 'No reports found in this run.';
                speciesListElement.appendChild(listItem);
                reportViewerElement.src = 'about:blank';
                return;
            }

            speciesInRun.forEach(species => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.textContent = species.names[selectedLang] || species.names['la'];
                link.dataset.fileKey = species.fileKey;
                listItem.appendChild(link);
                speciesListElement.appendChild(listItem);
            });
            
            const firstLink = speciesListElement.querySelector('a');
            if (firstLink) {
                setTimeout(() => firstLink.click(), 0);
            } else {
                reportViewerElement.src = 'about:blank';
            }
        }
        
        function onRunChange() {
            const selectedRun = document.querySelector('input[name="run-version"]:checked').value;
            populateSpeciesList(selectedRun);
        }

        function updateReport() {
            const selectedRun = document.querySelector('input[name="run-version"]:checked')?.value;
            if (!selectedRun || !currentSpeciesKey) {
                reportViewerElement.src = 'about:blank';
                return;
            }
            const fileName = `Fish/${selectedRun}/ProtectBaltic_ModelReport_${currentSpeciesKey}.html`;
            reportViewerElement.src = fileName;
        }

        // --- EVENT LISTENERS ---

        speciesListElement.addEventListener('click', function(event) {
            if (event.target.tagName === 'A') {
                const link = event.target;
                currentSpeciesKey = link.dataset.fileKey;
                updateReport();
                if (currentActiveLink) {
                    currentActiveLink.classList.remove('active');
                }
                link.classList.add('active');
                currentActiveLink = link;
            }
        });

        // ÄNDRAD: Lyssnare för språkväljaren (loopar och sätter en lyssnare på varje knapp)
        languageRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const selectedLang = this.value;
                localStorage.setItem('preferredLanguage', selectedLang);
                onRunChange(); // Ladda om artlistan med det nya språket
            });
        });

        // --- INITIALISERING ---
        
        // ÄNDRAD: Sättet att ladda sparat språk för radioknappar
        function initializeLanguage() {
            const savedLang = localStorage.getItem('preferredLanguage');
            if (savedLang) {
                // Hitta radioknappen med det sparade värdet och checka för den
                const radioToSelect = document.querySelector(`input[name="language"][value="${savedLang}"]`);
                if (radioToSelect) {
                    radioToSelect.checked = true;
                }
            }
        }
        
        initializeLanguage();
        populateRunSelector();
        onRunChange();
    });
    </script>

</body>
</html>